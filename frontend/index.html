<!doctype html><html><head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/axios@1.7.7/dist/axios.min.js"></script>
<link href="./assets/css/styles.css" rel="stylesheet">
<script defer src="./assets/js/utils.js"></script>
<script defer src="./assets/js/api.js"></script>
</head><body><div id="app-navbar"></div>
<div class="container py-5">
  <form id="login-form">
    <div id="login-error" class="alert alert-danger d-none" role="alert"></div>
    <input name="email" class="form-control mb-2" placeholder="email" required>
    <input name="password" type="password" class="form-control mb-2" placeholder="password" required>
    <button class="btn btn-primary" type="submit">Sign in</button>
  </form>
</div>
<script>
document.addEventListener('DOMContentLoaded', ()=>{
  renderNavbar();
  const form = document.getElementById('login-form');
  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const submitBtn = form.querySelector('button[type="submit"]');
    const errorBox = document.getElementById('login-error');
    const fd = new FormData(form);

    errorBox.classList.add('d-none');
    errorBox.textContent = '';
    submitBtn.disabled = true;

    try {
      const res = await axios.post('http://localhost:4000/auth/login', {
        email: fd.get('email'),
        password: fd.get('password')
      });

      const { token, user } = res.data;
      localStorage.setItem('ojpms_token', token);
      localStorage.setItem('ojpms_user', JSON.stringify(user));
      navigateTo('prospects/kanban.html');
    } catch (err) {
      const message = err?.response?.data?.message || 'Unable to sign in. Please check your credentials and try again.';
      errorBox.textContent = message;
      errorBox.classList.remove('d-none');
    } finally {
      submitBtn.disabled = false;
    }
  });
});
</script>
</body></html>