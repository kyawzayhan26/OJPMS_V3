<!doctype html><html><head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/axios@1.7.7/dist/axios.min.js"></script>
<link href="./assets/css/styles.css" rel="stylesheet">
<script defer src="./assets/js/utils.js"></script>
<script defer src="./assets/js/api.js"></script>
</head><body class="bg-light">
<div class="d-flex flex-column min-vh-100">
  <div class="flex-grow-1 d-flex align-items-center justify-content-center py-5">
    <div class="card shadow-sm" style="max-width: 420px; width: 100%;">
      <div class="card-body p-4">
        <h1 class="h4 text-center mb-3">Welcome to OJPMS</h1>
        <form id="login-form" class="d-flex flex-column gap-3">
          <div id="login-error" class="alert alert-danger d-none" role="alert"></div>
          <div>
            <label for="login-email" class="form-label">Email</label>
            <input id="login-email" name="email" type="email" class="form-control" placeholder="Enter your email" required>
          </div>
          <div>
            <label for="login-password" class="form-label">Password</label>
            <input id="login-password" name="password" type="password" class="form-control" placeholder="Enter your password" required>
          </div>
          <button class="btn btn-primary w-100" type="submit">Sign in</button>
        </form>
      </div>
    </div>
  </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const form = document.getElementById('login-form');
  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const submitBtn = form.querySelector('button[type="submit"]');
    const errorBox = document.getElementById('login-error');
    const fd = new FormData(form);

    errorBox.classList.add('d-none');
    errorBox.textContent = '';
    submitBtn.disabled = true;

    try {
      const res = await axios.post('http://localhost:4000/auth/login', {
        email: fd.get('email'),
        password: fd.get('password')
      });

      const { token, user } = res.data;
      localStorage.setItem('ojpms_token', token);
      localStorage.setItem('ojpms_user', JSON.stringify(user));
      navigateTo('prospects/kanban.html');
    } catch (err) {
      const message = err?.response?.data?.message || 'Unable to sign in. Please check your credentials and try again.';
      errorBox.textContent = message;
      errorBox.classList.remove('d-none');
    } finally {
      submitBtn.disabled = false;
    }
  });
});
</script>
</body></html>